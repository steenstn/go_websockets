<style>
    canvas {
        border:1px solid #666;
        image-rendering: optimizeSpeed;             /* Older versions of FF          */
        image-rendering: -moz-crisp-edges;          /* FF 6.0+                       */
        image-rendering: -o-crisp-edges;            /* OS X & Windows Opera (12.02+) */
        image-rendering: pixelated;                 /* Awesome future-browsers       */
        -ms-interpolation-mode: nearest-neighbor;   /* IE                            */
        position: absolute;
        top: 10%;
        left: 30%;
        transform:scale(2);
    }
</style>
<pre id="output"></pre>
<canvas id="c"></canvas>
<script>
    let c = document.getElementById('c')
    c.width = 320;
    c.height = 140;
    let  ctx = c.getContext('2d');
    ctx.fillStyle = "#000";
    //ctx.scale(2,2);
    let output = document.getElementById("output");
    let socket = new WebSocket("ws://localhost:8080/echo");

    let keysDown = {};


    addEventListener("keydown", function (e) {
        if(!e.repeat) {
            switch (e.key) {
                case "ArrowUp":
                    socket.send("up");
                    break;
                case "ArrowDown":
                    socket.send("down");
                    break;
                case "ArrowLeft":
                    socket.send("left");
                    break;
                case "ArrowRight":
                    socket.send("right");
                    break;
            }
        }
        keysDown[e.key] = true;
    }, false);

    addEventListener("keyup", function (e) {
        delete keysDown[e.key];
    }, false);



    socket.onopen = function () {
        output.innerHTML += "Status: Connected\n";
//        socket.send("register");
    };

    socket.onmessage = function (e) {
        console.log("Server: " + e.data)
        let res = JSON.parse(e.data)
        for(let i = 0; i < res.length; i++) {
            let x = res[i].X;
            let y = res[i].Y;
            ctx.fillRect(x,y,1,1);
        }

        //let x = res.X;
        //let y = res.Y;
        //ctx.fillRect(x,y,1,1);
        //output.innerHTML += "Server: " + e.data + "\n";
    };

</script>
